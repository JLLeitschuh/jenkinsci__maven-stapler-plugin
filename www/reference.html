<html>
<head>
	<title>Reference</title>
	<link rel="stylesheet" type="text/css" href="stapler.css" />
</head>
<body>



<h1>Reference</h1>
<p>
	This document explains the details of how Stapler "staples" your objects to URLs.
<p>
	The way Stapler works is some what like <a href="http://www-106.ibm.com/developerworks/java/library/j-jstl0211.html">Expression Language</a>; it takes an object and URL, then evaluate the URL against the object. It repeates this process until it hits either a static resource, a JSP, or an action method.
<p>
	There are many ways an URL can be evaluated against an object, as listed below. Stapler tries them in this order.

<h2>Before Evaluation Starts</h2>
<p>
	Before Stapler processes a request, it tests the following possibilities.
<ol>
	<li>If your web application defines other servlets or JSPs, they take precedence and they get executed normally.
	<li>If the URL matches a static resource in your web application, it will be served normally.
</ol>
<p>
	After the above conditions are checked, Stapler takes the application root object and evaluates that against the URL.

<h2>Evaluation of URL</h2>
<h3>Welcome Page</h3>
<p>
	If the URL is "/", then a welcome page for the current object is served. A welcome page is a side-file of the current object named <tt>index.jsp</tt> or <tt>index.html</tt>. If a welcome page doesn't exist, 404 NOT FOUND error will be sent.


<h3>Static Resources</h3>
<p>
	If the URL is "/xxxx.yyy" (a '/'-less string with a dot), then the side file of the current object by the name "xxxx.yyy" will be looked for and returned. This allows you to put static resources as side files to group them together.
<p>
	Note that this <b>cannot</b> be used to invoke JSPs.


<h3>Public Field</h3>
<p>
	If the URL is "/xxxx/..." (or "/xxxx" or "/xxxx/". these variations apply to all the others) and the current object has a public field named "xxxx", then the object stored in <tt>currentObject.xxxx</tt> will be evaluated against the rest of the URL "/...." recursively.


<h3>Public Getter Method</h3>
<p>
	If the URL is "/xxxx/..." and the current object has a public getter method named "getXxxx()", then the object returned from <tt>currentObject.getXxxx()</tt> will be evaluated against the rest of the URL "/...." recursively.
<p>
	Stapler also looks for the public getter of the form "getXxxx(StaplerRequest)". If such a method exists, then this getter method is invoked in a similar way. This version allows the get method to take sophisticated action based on the current request (such as returning the object specific to the current user, or returning null if the user is not authenticated.)


<h3>Public Getter Method with Argument</h3>
<p>
	If the URL is "/xxxx/yyyy/..." and the current object has a public method named "getXxxx(String arg)", then the object returned from <tt>currentObject.getXxxx("yyyy")</tt> will be evaluated against the rest of the URL "/...." recursively.
<p>
	Stapler also looks for the public getter of the form "getXxxx(StaplerRequest,String)".


<h3>Action Method</h3>
<p>
	If the URL is of the form "/xxxx/...." and the current object has a public "action" method named "doXxxx(StaplerRequest,StaplerResponse)", then this method is invoked.
<p>
	The action method is expected to serve the request, and once it returns normally, Stapler finishes processing the request.



<h3>Array</h3>
<p>
	If the current object is an array and the URL is "/nnnn/...." where nnnn is a number, then the object returned from <tt>currentObject[nnnn]</tt> will be evaluated against the rest of the URL "/...." recursively.



<h3>List</h3>
<p>
	If the current object implements <tt>java.util.List</tt> and the URL is "/nnnn/...." where nnnn is a number, then the object returned from <tt>currentObject.get(nnnn)</tt> will be evaluated against the rest of the URL "/...." recursively.



<h3>Map</h3>
<p>
	If the current object implements <tt>java.util.Map</tt> and the URL is "/xxxx/....", then the object returned from <tt>currentObject.get("xxxx")</tt> will be evaluated against the rest of the URL "/...." recursively.



<h3>JSP</h3>
<p>
	If the URL is "/xxxx/...." and a side file of the current object named <tt>xxxx.jsp</tt> exists, then that JSP gets executed.



<h3>If None of the Above Works</h3>
<p>
	... then the client receives 404 NOT FOUND error.




<h1>Side Files</h1>
<p>
	A Java class can have associated static resources / JSPs, which are called "side files".
	Side files are placed under <tt>/WEB-INF/side-files</tt>, organized by their class names.
	For example, side files for the class <tt>org.acme.foo.Bar</tt> would be in the
	<tt>/WEB-INF/side-files/org/acme/foo/Bar/</tt> folder.
<p>
	Side files are ideal way to group together resources that are local to a particular class, because they can be referenced by a very simple relative URL from action methods / JSPs.
<p>
	For example, if you got the following file sturcture, you can write &lt;img src="logo.png"> in index.html to refer to the image.
<pre>
/WEB-INF
 +- web.xml
 +- classes
 |  +- ...
 +- lib
 |  +- stapler.jar
 +- side-files
    +- org
       +- acme
          +- foo
             +- Bar
                +- index.html
                +- logo.png
</pre>
<h3>JSPs</h3>
<p>
	JSPs can be also placed as side files, although when you refer to them, you can't use the .jsp extension. (See the JSP sub-section above) When side-file JSP is executed, the request-scope variable "it" is set to the object for which the side file is invoked.
<p>
	For example, if your JSP looks like the following, then it prints the name property of the current object.
<pre class=code
>&lt;html>&lt;body>
  My name is ${it.name}
&lt;/body>&lt;/html></pre>
<p>
	The request object visible from the JSP is actually a StaplerRequest object, so you can access all the properties defined on it. The same apply to the response object, too.